# Changelog - Collection Encryption Feature

## [2025-11-24] - Collection Encryption System

### ‚ú® –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### 1. –¢–∏–ø—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∫–æ–ª–ª–µ–∫—Ü–∏–π
- **None**: –ü—É–±–ª–∏—á–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **Personal**: –ü—Ä–∏–≤–∞—Ç–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—á–Ω—ã–º –∫–ª—é—á–æ–º
- **Group**: –ì—Ä—É–ø–ø–æ–≤–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
- **P2P**: Peer-to-peer —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å ECDH
- **Hybrid**: –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º –¥–ª—è –≥–∏–±–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è

#### 2. GraphQL DSL –¥–∏—Ä–µ–∫—Ç–∏–≤—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `@encryption` –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ö–µ–º—ã
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: type, keyId, participants, encryptFields, allowRecipientOverride
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ GraphQL —Å—Ö–µ–º—ã

#### 3. –ú–µ—Ö–∞–Ω–∏–∑–º –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏
- **P2P Exchange**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω ECDH X25519 + HKDF –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏
- **Group Management**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∫–ª—é—á–µ–π
- **Key Rotation**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –¥–ª—è P2P

#### 4. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- EventEncryptor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —à–∏—Ñ—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—è)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π

### üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

#### Schema Layer
- `internal/schema/types.go`: –†–∞—Å—à–∏—Ä–µ–Ω —Ç–∏–ø–∞–º–∏ `CollectionEncryptionType` –∏ `EncryptionConfig`

#### Key Management
- `internal/keymanager/p2p_exchange.go`: P2P –æ–±–º–µ–Ω –∫–ª—é—á–∞–º–∏ —á–µ—Ä–µ–∑ ECDH
- `internal/keymanager/keymgr.go`: –†–∞—Å—à–∏—Ä–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∏ P2P –∫–ª—é—á–µ–π
- `internal/keymanager/encryption.go`: –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `GroupKeyID`

#### Event Layer
- `internal/event/encryption.go`: EventEncryptor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

#### Documentation & Examples
- `internal/collection/ENCRYPTION.md`: –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—é
- `examples/encryption/encryption_examples.go`: –ü—Ä–∏–º–µ—Ä—ã –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- `examples/encryption/README.md`: –ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

### üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è

#### `internal/schema/parser.go`
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `parseEncryptionConfig()` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã @encryption
- –†–∞—Å—à–∏—Ä–µ–Ω `injectDirectiveDefinitions()` –Ω–æ–≤—ã–º–∏ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏

#### `internal/schema/types.go`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `EncryptionConfig` –≤ `SchemaDefinition`
- –ù–æ–≤—ã–µ —Ç–∏–ø—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

#### `internal/keymanager/keymgr.go`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `GroupKey` –¥–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∫–ª—é—á–µ–π
- –†–∞—Å—à–∏—Ä–µ–Ω `KeyManager` –ø–æ–ª—è–º–∏ `groupKeys` –∏ `p2pExchange`
- –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
  - `CreateGroupKey()` - —Å–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ –∫–ª—é—á–∞
  - `GetGroupKey()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ –∫–ª—é—á–∞
  - `AddParticipantToGroup()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  - `RemoveParticipantFromGroup()` - —É–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  - `IsParticipantInGroup()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–∏—è
  - `EncryptForP2P()` - P2P —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
  - `DecryptFromP2P()` - P2P —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
  - `EstablishP2PKey()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ P2P –∫–ª—é—á–∞

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –ê–ª–≥–æ—Ä–∏—Ç–º—ã
- ChaCha20-Poly1305 –¥–ª—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (256-bit)
- ECDH X25519 –¥–ª—è –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏
- HKDF-SHA256 –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∫–ª—é—á–µ–π

#### –ó–∞—â–∏—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º/—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ò–∑–æ–ª—è—Ü–∏—è –∫–ª—é—á–µ–π –ø–æ —Ç–∏–ø–∞–º (personal/group/p2p)
- Forward secrecy –¥–ª—è P2P –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π

### üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

#### –ù–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞ –∫–ª—é—á–∞–º–∏ –¥–ª—è P2P
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- Best practices –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- API reference

#### –ü—Ä–∏–º–µ—Ä—ã
- 5 —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–π –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ü—Ä–∏–º–µ—Ä—ã GraphQL —Å—Ö–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
- –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏

### üéØ Use Cases

1. **–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –î–Ω–µ–≤–Ω–∏–∫–∏, –∑–∞–º–µ—Ç–∫–∏ - personal encryption
2. **–ö–æ–º–∞–Ω–¥–Ω–∞—è —Ä–∞–±–æ—Ç–∞**: –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã - group encryption
3. **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ß–∞—Ç—ã 1-–Ω–∞-1 - P2P encryption
4. **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∑–∞–ø–∏—Å–∏**: –ß–∞—Å—Ç–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
5. **–§–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**: –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –¥–æ—Å—Ç—É–ø–∞

### üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±–µ–∑ @encryption –¥–∏—Ä–µ–∫—Ç–∏–≤—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ú–æ–∂–Ω–æ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ChaCha20-Poly1305 –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é —Å–∫–æ—Ä–æ—Å—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- P2P –∫–ª—é—á–∏ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –¥–ª—è –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π

### üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–ª—è P2P –Ω–µ–æ–±—Ö–æ–¥–∏–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ–±–º–µ–Ω –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- –ì—Ä—É–ø–ø–æ–≤—ã–µ –∫–ª—é—á–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –≥—Ä—É–ø–ø—ã
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–∞–≤–∞ –≥—Ä—É–ø–ø—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–∞
- –õ–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–¥—ë–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

### üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- End-to-end encryption –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- Audit log –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∫–ª—é—á–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Hardware Security Modules (HSM)
- Multi-signature –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Zero-knowledge proofs –¥–ª—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤–ª–∞–¥–µ–Ω–∏—è
